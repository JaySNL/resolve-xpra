[supervisord]
nodaemon=true
# Fix: Log to stdout to avoid permission errors and follow container best practices.
logfile=/dev/stdout
logfile_maxbytes=0
pidfile=/var/run/supervisord.pid

[program:xfce4-session]
# Command to start the XFCE desktop environment
command=startxfce4
priority=10
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
user=pod
# Ensure the session knows which display to use
environment=DISPLAY=":0"

[program:x11vnc]
# Command to start the VNC server, attached to the running XFCE session
command=/usr/bin/x11vnc -display :0 -rfbport %(ENV_VNC_PORT)s -forever -nopw -auth guess -xkb -noshm
priority=20
# Give XFCE a few seconds to start before attaching VNC
startsecs=5
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
user=pod
environment=HOME="/home/pod"

[program:websockify]
# Command to start the HTML5 client proxy
command=/usr/bin/websockify --web=/usr/share/novnc %(ENV_NOVNC_PORT)s localhost:%(ENV_VNC_PORT)s
priority=30
startsecs=6
autostart=true
autorestart=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
user=pod